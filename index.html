<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACRYLIX LUXE | Bespoke 3D Art</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Syncopate:wght@400;700&family=Plus+Jakarta+Sans:wght@200;400;700&display=swap');
        
        :root {
            --gold: #D4AF37;
            --dark: #080808;
        }

        body { 
            background: var(--dark); 
            color: #fff; 
            font-family: 'Plus Jakarta Sans', sans-serif;
            overflow-x: hidden;
        }

        .bg-mesh {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(at 0% 0%, rgba(212, 175, 55, 0.08) 0, transparent 50%), 
                radial-gradient(at 100% 100%, rgba(0, 240, 255, 0.05) 0, transparent 50%);
            z-index: -1;
        }

        #canvas-container { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100vw;
            height: 100vh;
            z-index: 1; 
            pointer-events: none; 
            transition: filter 1s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .luxury-heading {
            font-family: 'Syncopate', sans-serif;
            letter-spacing: -0.05em;
            background: linear-gradient(180deg, #fff 0%, rgba(255,255,255,0.4) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.6s cubic-bezier(0.23, 1, 0.32, 1);
        }

        .glass-card:hover {
            background: rgba(212, 175, 55, 0.05);
            border-color: var(--gold);
            transform: translateY(-10px);
        }

        .gold-btn {
            border: 1px solid var(--gold);
            color: var(--gold);
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .gold-btn:hover {
            background: var(--gold);
            color: black;
            box-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
        }

        .scroll-indicator {
            width: 1px;
            height: 80px;
            background: linear-gradient(to bottom, var(--gold), transparent);
            position: absolute;
            bottom: 0;
            left: 50%;
        }

        #process-overlay {
            position: fixed;
            inset: 0;
            background: rgba(8, 8, 8, 0.98);
            backdrop-filter: blur(50px);
            z-index: 1000;
            display: none;
            opacity: 0;
            overflow-y: auto;
            padding: 80px 40px;
        }

        .process-grid {
            max-width: 1000px;
            margin: 0 auto;
            display: grid;
            gap: 40px;
        }

        .step-num {
            color: var(--gold);
            font-family: 'Syncopate', sans-serif;
            font-size: 0.7rem;
            letter-spacing: 0.5em;
            margin-bottom: 10px;
            display: block;
        }

        .nav-link { position: relative; padding-bottom: 5px; cursor: pointer; }
        .nav-link::after { content: ''; position: absolute; bottom: 0; left: 0; width: 0; height: 1px; background: var(--gold); transition: width 0.4s ease; }
        .nav-link:hover::after { width: 100%; }

        .catalog-dropdown { position: relative; }
        .dropdown-panel {
            visibility: hidden; opacity: 0; position: absolute; top: 100%; left: -50%;
            transform: translateY(20px); background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(40px); border: 1px solid rgba(255, 255, 255, 0.05);
            padding: 2rem; min-width: 280px; transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
            z-index: 1000; margin-top: 1.5rem;
        }
        .catalog-dropdown:hover .dropdown-panel { visibility: visible; opacity: 1; transform: translateY(0); }
        .dropdown-item { display: flex; align-items: center; padding: 0.75rem 0; color: #666; font-size: 10px; letter-spacing: 0.3em; transition: all 0.3s; border-bottom: 1px solid rgba(255, 255, 255, 0.03); width: 100%; text-align: left; background: transparent; }
        .dropdown-item:hover { color: var(--gold); padding-left: 10px; }

        .contact-select {
            background: transparent;
            border: none;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 15px 0;
            width: 100%;
            font-size: 10px;
            letter-spacing: 2px;
            color: #666;
            outline: none;
            cursor: pointer;
            appearance: none;
        }

        #contact {
            display: none;
            opacity: 0;
            transform: translateY(30px);
        }

        .contact-input {
            background: transparent;
            border: none;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 15px 0;
            width: 100%;
            font-size: 12px;
            letter-spacing: 2px;
            color: white;
            outline: none;
            transition: border-color 0.4s;
        }
        .contact-input:focus { border-color: var(--gold); }

        .side-panel {
            position: fixed; top: 0; right: 0; height: 100vh; width: 100%; max-width: 450px;
            background: rgba(8, 8, 8, 0.98); backdrop-filter: blur(40px);
            z-index: 2000; transform: translateX(100%); transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1);
            border-left: 1px solid rgba(212, 175, 55, 0.2); padding: 40px;
        }
        .side-panel.active { transform: translateX(0); }
        .cart-count { background: var(--gold); color: black; font-size: 8px; padding: 2px 6px; border-radius: 10px; margin-left: 5px; vertical-align: middle; }
        .auth-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 3000;
            display: none; place-items: center; opacity: 0; backdrop-filter: blur(10px);
        }

        .cart-flyer {
            position: fixed;
            width: 20px;
            height: 20px;
            background: var(--gold);
            border-radius: 50%;
            z-index: 5000;
            pointer-events: none;
            box-shadow: 0 0 15px var(--gold);
        }

        /* Payment Logic Styles */
        #payment-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 4000;
            display: none; place-items: center; opacity: 0; backdrop-filter: blur(20px);
        }
        .payment-card { border: 1px solid rgba(255,255,255,0.1); padding: 20px; border-radius: 4px; cursor: pointer; transition: 0.3s; }
        .payment-card:hover { border-color: var(--gold); background: rgba(212,175,55,0.05); }
    </style>
</head>
<body>

    <div class="bg-mesh"></div>
    <div id="canvas-container"></div>

    <div id="cart-panel" class="side-panel flex flex-col">
        <div class="flex justify-between items-center mb-10">
            <h2 class="text-2xl luxury-heading uppercase">Your Selection</h2>
            <button onclick="toggleCart()" class="text-white text-xs tracking-widest uppercase hover:text-gold transition-colors">Close ✕</button>
        </div>
        <div id="cart-items" class="flex-grow overflow-y-auto space-y-6">
            <p class="text-gray-500 text-[10px] tracking-widest uppercase py-10">The bag is currently empty.</p>
        </div>
        <div class="border-t border-white/10 pt-8 mt-4">
            <div class="flex justify-between items-center mb-6">
                <span class="text-[10px] tracking-[0.3em] uppercase opacity-50">Estimated Total</span>
                <span id="cart-total" class="text-xl font-bold">£0.00</span>
            </div>
            <button onclick="handleCheckout()" class="gold-btn w-full py-6 text-[10px] font-bold uppercase tracking-[0.4em] mb-4">Secure Checkout (UK)</button>
            <div class="flex justify-center gap-4 opacity-30 grayscale">
                <span class="text-[8px]">VISA</span><span class="text-[8px]">APPLE PAY</span><span class="text-[8px]">AMEX</span>
            </div>
        </div>
    </div>

    <div id="payment-overlay">
        <div class="glass-card p-12 w-full max-w-lg">
            <h3 class="text-2xl luxury-heading mb-10 text-center">SELECT PAYMENT</h3>
            <div class="space-y-4">
                <div class="payment-card flex justify-between items-center">
                    <span class="text-xs tracking-widest uppercase font-bold">Credit / Debit Card</span>
                    <span class="text-[8px] opacity-40">STRIPE</span>
                </div>
                <div class="payment-card flex justify-between items-center">
                    <span class="text-xs tracking-widest uppercase font-bold">Klarna</span>
                    <span class="text-[8px] opacity-40">PAY LATER</span>
                </div>
                <div class="payment-card flex justify-between items-center">
                    <span class="text-xs tracking-widest uppercase font-bold">PayPal</span>
                    <span class="text-[8px] opacity-40">EXPRESS</span>
                </div>
            </div>
            <button onclick="closePayment()" class="mt-8 text-[8px] tracking-[0.5em] uppercase opacity-50 block w-full text-center">Cancel Transaction</button>
        </div>
    </div>

    <div id="product-detail" class="side-panel">
        <button onclick="closeProduct()" class="text-gold text-[10px] tracking-widest mb-10 uppercase">← Back to Gallery</button>
        <div id="product-content"></div>
    </div>

    <div id="auth-modal" class="auth-overlay">
        <div class="glass-card p-12 w-full max-w-md text-center">
            <h3 class="text-2xl luxury-heading mb-8">CLIENT ACCESS</h3>
            <input type="email" placeholder="EMAIL" class="contact-input mb-6">
            <input type="password" placeholder="PASSWORD" class="contact-input mb-10">
            <button onclick="loginUser()" class="gold-btn w-full py-4 text-[10px] tracking-widest mb-4">LOGIN</button>
            <button onclick="toggleAuth()" class="text-[8px] tracking-widest opacity-50 uppercase">Cancel</button>
        </div>
    </div>

    <nav id="main-nav" class="fixed w-full flex justify-between p-8 z-[100] items-center mix-blend-difference">
        <div class="text-xl font-bold tracking-[0.4em] luxury-heading cursor-pointer" onclick="location.reload()">ACRYLIX</div>
        <div class="hidden md:flex gap-12 text-[10px] uppercase tracking-[0.3em] font-bold items-center">
            
            <div class="catalog-dropdown">
                <span class="nav-link">Catalog <small class="ml-1 opacity-50">▼</small></span>
                <div class="dropdown-panel">
                    <p class="text-[8px] text-gray-500 mb-4 tracking-[0.5em] border-b border-gold/20 pb-2">COLLECTIONS</p>
                    <button onclick="filterItems('all')" class="dropdown-item">ALL PIECES <span>→</span></button>
                    <button onclick="filterItems('table')" class="dropdown-item">COFFEE TABLES <span>→</span></button>
                    <button onclick="filterItems('console')" class="dropdown-item">LUXURY WALL <span>→</span></button>
                    <button onclick="filterItems('dining')" class="dropdown-item">DINING SETS <span>→</span></button>
                </div>
            </div>

            <button onclick="openProcess()" class="nav-link">Process</button>
            <button onclick="toggleContact()" class="nav-link">Contact</button>
            
            <button onclick="toggleAuth()" class="nav-link">Account</button>
            <button id="cart-nav-btn" onclick="toggleCart()" class="nav-link">Cart<span id="cart-badge" class="cart-count">0</span></button>
        </div>
    </nav>

    <div id="process-overlay">
        <div class="flex justify-between items-center max-w-6xl mx-auto mb-20">
            <h2 class="text-4xl font-bold luxury-heading">THE CRAFT</h2>
            <button onclick="closeProcess()" class="text-gold tracking-[0.5em] text-[10px] border border-gold/30 px-6 py-2 hover:bg-gold hover:text-black transition-all">CLOSE ✕</button>
        </div>
        
        <div class="process-grid grid grid-cols-1 md:grid-cols-2">
            <div class="glass-card p-10">
                <span class="step-num">01. OPTICAL PURITY</span>
                <h3 class="text-xl font-bold mb-4 tracking-tighter">MATERIAL SELECTION</h3>
                <p class="text-gray-500 text-xs leading-loose tracking-widest">We source laboratory-grade acrylic blocks with zero internal inclusions.</p>
            </div>
            <div class="glass-card p-10">
                <span class="step-num">02. MASTER SCULPTING</span>
                <h3 class="text-xl font-bold mb-4 tracking-tighter">DIAMOND CUTTING</h3>
                <p class="text-gray-500 text-xs leading-loose tracking-widest">Complex 3D geometries are carved using 5-axis diamond-tipped technology.</p>
            </div>
        </div>
    </div>

    <section class="flex flex-col justify-center items-start px-10 md:px-32 relative h-screen">
        <span class="text-[#D4AF37] text-xs font-bold tracking-[0.5em] uppercase mb-6">Established 2024</span>
        <h1 class="text-7xl md:text-[11rem] font-bold leading-[0.85] luxury-heading">LUXE<br>VOID.</h1>
        <p class="max-w-md mt-10 text-gray-500 text-sm leading-loose tracking-widest uppercase">
            Sculpting transparency into timeless furniture. Diamond-polished perfection.
        </p>
        <button onclick="document.getElementById('gallery').scrollIntoView({behavior: 'smooth'})" class="gold-btn mt-12 px-10 py-4 text-[10px] font-bold uppercase tracking-[0.2em]">
            View Collection
        </button>
        <div class="scroll-indicator"></div>
    </section>

  <section id="gallery" class="py-40 px-10 md:px-32 relative z-10">
        <div class="flex flex-col md:flex-row justify-between items-end mb-24 gap-8">
            <h2 class="text-5xl font-bold luxury-heading uppercase" id="gallery-title">THE GALLERY.</h2>
            <p class="text-gray-500 text-xs tracking-widest uppercase max-w-xs">Curated pieces for sophisticated spaces.</p>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-3 gap-x-8 gap-y-32" id="item-grid">
            
            <div class="glass-card product-item table p-1 relative overflow-hidden group">
                <div class="h-[450px] bg-[#111] overflow-hidden cursor-pointer" onclick="viewProduct('GHOST COFFEE TABLE', 2100, 'Hand-polished optical grade acrylic. Single-pour seamless design.', '2.webp')">
                    <img src="2.webp" alt="Ghost Table" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700">
                </div>
                <div class="p-8 relative z-20">
                    <h3 class="text-lg font-bold tracking-tighter mb-1 uppercase">GHOST COFFEE TABLE</h3>
                    <div class="flex justify-between items-center mb-6">
                        <p class="text-[#D4AF37] text-[10px] font-bold tracking-widest uppercase">£2,100</p>
                    </div>
                    <div class="border-t border-gold/40 pt-6 flex justify-between items-center">
                        <button onclick="toggleContact()" class="group/btn">
                            <span class="text-[9px] font-bold tracking-[0.4em] text-white group-hover/btn:text-gold transition-colors uppercase">Bespoke</span>
                        </button>
                        <button onclick="addToCart('GHOST COFFEE TABLE', 2100, event)" class="text-[9px] text-gold font-bold tracking-widest">+ ADD TO BAG</button>
                    </div>
                </div>
            </div>

            <div class="glass-card product-item console p-1 relative overflow-hidden group md:translate-y-20">
                <div class="h-[450px] bg-[#111] overflow-hidden cursor-pointer" onclick="viewProduct('CRYSTAL WALL PANEL', 4500, 'Diamond cut texture. Includes integrated LED backlight mount.', 'wall.jpg')">
                    <img src="wall.jpg" alt="Luxury Wall" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700">
                </div>
                <div class="p-8 relative z-20">
                    <h3 class="text-lg font-bold tracking-tighter mb-1 uppercase">CRYSTAL WALL PANEL</h3>
                    <div class="flex justify-between items-center mb-6">
                        <p class="text-[#D4AF37] text-[10px] font-bold tracking-widest uppercase">£4,500</p>
                    </div>
                    <div class="border-t border-gold/40 pt-6 flex justify-between items-center">
                        <button onclick="toggleContact()" class="group/btn">
                            <span class="text-[9px] font-bold tracking-[0.4em] text-white group-hover/btn:text-gold transition-colors uppercase">Bespoke</span>
                        </button>
                        <button onclick="addToCart('CRYSTAL WALL PANEL', 4500, event)" class="text-[9px] text-gold font-bold tracking-widest">+ ADD TO BAG</button>
                    </div>
                </div>
            </div>

            <div class="glass-card product-item dining p-1 relative overflow-hidden group">
                <div class="h-[450px] bg-[#111] overflow-hidden cursor-pointer" onclick="viewProduct('PRISM DINING TABLE', 8200, 'Heavy-duty structural acrylic. Polished prism edges.', '3.webp')">
                    <img src="3.webp" alt="Dining Set" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700">
                </div>
                <div class="p-8 relative z-20">
                    <h3 class="text-lg font-bold tracking-tighter mb-1 uppercase">PRISM DINING TABLE</h3>
                    <div class="flex justify-between items-center mb-6">
                        <p class="text-[#D4AF37] text-[10px] font-bold tracking-widest uppercase">£8,200</p>
                    </div>
                    <div class="border-t border-gold/40 pt-6 flex justify-between items-center">
                        <button onclick="toggleContact()" class="group/btn">
                            <span class="text-[9px] font-bold tracking-[0.4em] text-white group-hover/btn:text-gold transition-colors uppercase">Bespoke</span>
                        </button>
                        <button onclick="addToCart('PRISM DINING TABLE', 8200, event)" class="text-[9px] text-gold font-bold tracking-widest">+ ADD TO BAG</button>
                    </div>
                </div>
            </div>
            <div class="glass-card product-item dinning p-1 relative overflow-hidden group md:translate-y-20">
                <div class="h-[450px] bg-[#111] overflow-hidden cursor-pointer" onclick="viewProduct('PRISM DINING TABLE', 4500, 'Diamond cut texture. Includes integrated LED backlight mount.', '6.avif')">
                    <img src="6.avif" alt="Dining Set" class="w-full h-full object-cover grayscale group-hover:grayscale-0 transition-all duration-700">
                </div>
                <div class="p-8 relative z-20">
                    <h3 class="text-lg font-bold tracking-tighter mb-1 uppercase">CRYSTAL WALL PANEL</h3>
                    <div class="flex justify-between items-center mb-6">
                        <p class="text-[#D4AF37] text-[10px] font-bold tracking-widest uppercase">£4,500</p>
                    </div>
                    <div class="border-t border-gold/40 pt-6 flex justify-between items-center">
                        <button onclick="toggleContact()" class="group/btn">
                            <span class="text-[9px] font-bold tracking-[0.4em] text-white group-hover/btn:text-gold transition-colors uppercase">Bespoke</span>
                        </button>
                        <button onclick="addToCart('CRYSTAL WALL PANEL', 4500, event)" class="text-[9px] text-gold font-bold tracking-widest">+ ADD TO BAG</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="contact" class="py-40 px-10 md:px-32 relative z-10">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-20">
            <div>
                <h2 class="text-6xl font-bold luxury-heading mb-10">START A<br>PROJECT.</h2>
                <p class="text-gray-500 text-sm tracking-widest uppercase leading-loose max-w-sm">Elevate your space with a custom commission. Let's discuss your vision.</p>
                <div class="mt-20 space-y-8">
                    <div>
                        <p class="text-[8px] text-gold tracking-[0.5em] mb-2 uppercase">Email us</p>
                        <p class="text-xl font-light tracking-widest">STUDIO@ACRYLIX.COM</p>
                    </div>
                </div>
            </div>
            <div class="glass-card p-12">
                <form class="space-y-12">
                    <div class="group"><input type="text" placeholder="YOUR NAME" class="contact-input"></div>
                    <div class="group"><input type="email" placeholder="EMAIL ADDRESS" class="contact-input"></div>
                    <div class="group">
                        <select class="contact-select uppercase">
                            <option value="" disabled selected>SELECT SERVICE TYPE</option>
                            <option value="custom">BESPOKE CUSTOM DESIGN</option>
                            <option value="catalog">CATALOG PIECE MODIFICATION</option>
                            <option value="consult">INTERIOR CONSULTATION</option>
                        </select>
                    </div>
                    <div class="group"><input type="text" placeholder="TELL US ABOUT THE PROJECT" class="contact-input"></div>
                    <button type="button" class="gold-btn w-full py-6 text-[10px] font-bold uppercase tracking-[0.4em]">SEND INQUIRY</button>
                </form>
            </div>
        </div>
    </section>

    <footer class="p-20 text-center border-t border-white/5 relative z-10">
        <p class="text-[10px] tracking-[0.5em] text-gray-600 uppercase">© 2026 ACRYLIX STUDIOS. ALL RIGHTS RESERVED.</p>
    </footer>

    <script type="importmap"> { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js" } } </script>

    <script type="module">
        import * as THREE from 'three';
        gsap.registerPlugin(ScrollTrigger);

        let cart = [];
        let isLoggedIn = false; // Logic track karne ke liye
// ... baqi code ke niche ...
// --- SECURE PAYMENT INTEGRATION ---
window.handleCheckout = async () => {
    // 1. Check if cart is empty
    if (cart.length === 0) {
        alert("YOUR SELECTION IS EMPTY");
        return;
    }

    // 2. Check Authentication
    if (!isLoggedIn) {
        alert("CLIENT ACCESS REQUIRED FOR CHECKOUT");
        toggleCart();
        toggleAuth();
        return;
    }

    // 3. UI Feedback - Change Button State
    const checkoutBtn = event.target;
    const originalText = checkoutBtn.innerText;
    checkoutBtn.innerText = "INITIALIZING SECURE ENCRYPTION...";
    checkoutBtn.disabled = true;

    try {
        // 4. Call your Render Backend to create a Stripe Session
        const response = await fetch("https://acrylic.onrender.com/api/create-checkout-session", {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                items: cart, // Sending items to backend
                email: currentUserEmail // Tracking the customer
            })
        });

        const session = await response.json();

        if (session.url) {
            // 5. Redirect to Professional Stripe Hosted Page
            window.location.href = session.url;
        } else {
            throw new Error("Session creation failed");
        }

    } catch (error) {
        console.error("Payment Error:", error);
        alert("CONNECTION ERROR: SECURE GATEWAY UNAVAILABLE");
        
        // Reset Button
        checkoutBtn.innerText = originalText;
        checkoutBtn.disabled = false;
    }
};
// --- Logic Functions ---
window.handleCheckout = async () => {
    if (cart.length === 0) return alert("Bag is empty");
    
    // Jab aap Render par deploy kar dein, toh ye URL badal dena
    const API_URL = "https://acrylic.onrender.com/api/checkout";

    const orderPayload = {
        items: cart,
        total: document.getElementById('cart-total').innerText,
        customer: { email: "client@example.com" } 
    };

    try {
        const response = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(orderPayload)
        });

        if (response.ok) {
            alert("Order Placed Successfully!");
            cart = [];
            updateCartUI();
            toggleCart();
        } else {
            alert("Server error, please try again.");
        }
    } catch (error) {
        alert("Connection Error. Is the backend running?");
    }
};

// ... loginUser aur baqi functions ke upar ...
        const cartPanel = document.getElementById('cart-panel');
        const prodPanel = document.getElementById('product-detail');
        const authModal = document.getElementById('auth-modal');
        const payOverlay = document.getElementById('payment-overlay');

        window.toggleCart = () => cartPanel.classList.toggle('active');
        
        window.toggleAuth = () => {
            const isVisible = authModal.style.display === 'grid';
            authModal.style.display = isVisible ? 'none' : 'grid';
            gsap.to(authModal, { opacity: isVisible ? 0 : 1, duration: 0.5 });
        };

        // --- Logic Functions ---
        window.handleCheckout = () => {
            if (cart.length === 0) return alert("Bag is empty");
            
            if (!isLoggedIn) {
                toggleCart(); // Cart close
                toggleAuth(); // Login open
            } else {
                openPayment();
            }
        };

        window.loginUser = () => {
            isLoggedIn = true;
            // Close login modal
            gsap.to(authModal, { opacity: 0, duration: 0.4, onComplete: () => {
                authModal.style.display = 'none';
                // Open cart again
                toggleCart();
            }});
        };

        function openPayment() {
            payOverlay.style.display = 'grid';
            gsap.to(payOverlay, { opacity: 1, duration: 0.5 });
        }

        window.closePayment = () => {
            gsap.to(payOverlay, { opacity: 0, duration: 0.4, onComplete: () => payOverlay.style.display = 'none' });
        };

        // --- Original Functions ---
        window.viewProduct = (name, price, desc, img) => {
            document.getElementById('product-content').innerHTML = `
                <img src="${img}" class="w-full h-80 object-cover mb-8 grayscale hover:grayscale-0 transition-all">
                <h2 class="text-3xl luxury-heading mb-4">${name}</h2>
                <p class="text-gold text-xl mb-6">£${price}</p>
                <div class="space-y-4 text-xs tracking-widest text-gray-400 mb-10 leading-loose">
                    <p>${desc}</p>
                    <p class="text-white">MATERIAL: Optical Grade Acrylic</p>
                    <p class="text-white">LEAD TIME: 8-12 Weeks (UK Delivery)</p>
                </div>
                <button onclick="addToCart('${name}', ${price}, event)" class="gold-btn w-full py-6 text-[10px] font-bold tracking-[0.3em] uppercase">Add to Cart</button>
            `;
            prodPanel.classList.add('active');
        };
        window.closeProduct = () => prodPanel.classList.remove('active');

        window.addToCart = (name, price, event) => {
            cart.push({name, price});
            updateCartUI();
            const bubble = document.createElement('div');
            bubble.className = 'cart-flyer';
            document.body.appendChild(bubble);
            const startX = event.clientX;
            const startY = event.clientY;
            const cartBtn = document.getElementById('cart-nav-btn');
            const rect = cartBtn.getBoundingClientRect();
            const endX = rect.left + rect.width / 2;
            const endY = rect.top + rect.height / 2;
            gsap.set(bubble, { left: startX, top: startY });
            window.scrollTo({ top: 0, behavior: 'smooth' });
            gsap.to(bubble, {
                left: endX, top: endY, scale: 0.5, opacity: 0, duration: 1.2, ease: "power2.inOut",
                onComplete: () => {
                    bubble.remove();
                    gsap.fromTo("#cart-badge", { scale: 1.5 }, { scale: 1, duration: 0.4 });
                    setTimeout(() => { if(!cartPanel.classList.contains('active')) toggleCart(); }, 500);
                }
            });
        };

        function updateCartUI() {
            const container = document.getElementById('cart-items');
            const badge = document.getElementById('cart-badge');
            const total = document.getElementById('cart-total');
            badge.innerText = cart.length;
            if(cart.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-[10px] uppercase py-10">The bag is currently empty.</p>';
                total.innerText = '£0.00';
                return;
            }
            let sum = 0;
            container.innerHTML = cart.map((item, index) => {
                sum += item.price;
                return `
                    <div class="flex justify-between items-center border-b border-white/5 pb-4">
                        <div>
                            <p class="text-[10px] tracking-widest uppercase">${item.name}</p>
                            <p class="text-gold text-[10px]">£${item.price}</p>
                        </div>
                        <button onclick="removeFromCart(${index})" class="text-[8px] opacity-40 hover:opacity-100 transition-opacity">REMOVE</button>
                    </div>
                `;
            }).join('');
            total.innerText = `£${sum.toLocaleString()}`;
        }

        window.removeFromCart = (index) => {
            cart.splice(index, 1);
            updateCartUI();
        };

        window.toggleContact = () => {
            const contactSec = document.getElementById('contact');
            contactSec.style.display = 'block';
            gsap.to(contactSec, { opacity: 1, y: 0, duration: 1, ease: "expo.out", onComplete: () => { contactSec.scrollIntoView({ behavior: 'smooth' }); } });
        };

        ScrollTrigger.create({
            trigger: "#contact", start: "top bottom", 
            onLeaveBack: () => { gsap.to("#contact", { opacity: 0, y: 30, duration: 0.5, onComplete: () => { document.getElementById('contact').style.display = 'none'; } }); }
        });

        window.openProcess = () => {
            const overlay = document.getElementById('process-overlay');
            overlay.style.display = 'block';
            gsap.to(overlay, { opacity: 1, duration: 0.8 });
        };
        window.closeProcess = () => {
            gsap.to('#process-overlay', { opacity: 0, duration: 0.5, onComplete: () => document.getElementById('process-overlay').style.display = 'none' });
        };

        window.filterItems = (category) => {
            document.getElementById('gallery').scrollIntoView({ behavior: 'smooth' });
            const items = document.querySelectorAll('.product-item');
            const title = document.getElementById('gallery-title');
            gsap.to(title, { opacity: 0, y: 10, duration: 0.3, onComplete: () => {
                title.innerText = category === 'all' ? "THE GALLERY." : category.toUpperCase() + " COLLECTION.";
                gsap.to(title, { opacity: 1, y: 0, duration: 0.3 });
            }});
            items.forEach(item => {
                if (category === 'all' || item.classList.contains(category)) {
                    gsap.to(item, { scale: 1, opacity: 1, duration: 0.6, display: 'block' });
                } else {
                    gsap.to(item, { scale: 0.9, opacity: 0, duration: 0.4, display: 'none' });
                }
            });
        }

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.getElementById('canvas-container').appendChild(renderer.domElement);
        const geometry = new THREE.OctahedronGeometry(1.5, 0); 
        const material = new THREE.MeshPhysicalMaterial({ color: 0xffffff, metalness: 0.1, roughness: 0.05, transmission: 1, ior: 1.5, thickness: 2, clearcoat: 1 });
        const object3d = new THREE.Mesh(geometry, material);
        scene.add(object3d);
        const pointLight1 = new THREE.PointLight(0xD4AF37, 80); pointLight1.position.set(5, 5, 5); scene.add(pointLight1);
        const pointLight2 = new THREE.PointLight(0xffffff, 40); pointLight2.position.set(-5, -5, 5); scene.add(pointLight2);
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.8); scene.add(ambientLight);
        camera.position.z = 6;
        let mouseX = 0, mouseY = 0;
        window.addEventListener('mousemove', (e) => {
            mouseX = (e.clientX - window.innerWidth / 2) / 100;
            mouseY = (e.clientY - window.innerHeight / 2) / 100;
        });
        gsap.to(object3d.rotation, { y: Math.PI * 4, scrollTrigger: { trigger: "body", start: "top top", end: "bottom bottom", scrub: 2 } });
        ScrollTrigger.create({
            trigger: "#gallery", start: "top 80%",
            onEnter: () => gsap.to("#canvas-container", { filter: "blur(20px) brightness(0.5)", opacity: 0.4, duration: 1 }),
            onLeaveBack: () => gsap.to("#canvas-container", { filter: "blur(0px) brightness(1)", opacity: 1, duration: 1 })
        });
        function animate() {
            requestAnimationFrame(animate);
            object3d.rotation.x += 0.003;
            object3d.position.x += (mouseX - object3d.position.x) * 0.05;
            object3d.position.y += (-mouseY - object3d.position.y) * 0.05;
            renderer.render(scene, camera);
        }
        animate();
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
